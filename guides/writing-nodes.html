
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Writing Flow Nodes &#8212; Flow</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "enodis/flow-docs");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Specifying graphs" href="specifying-graphs.html" />
    <link rel="prev" title="Installing flow" href="installing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Flow</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Flow
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   User guides
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="installing.html">
     Installing flow
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Writing Flow Nodes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="specifying-graphs.html">
     Specifying graphs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="windowing.html">
     Windowing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/index.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../design/index.html">
   Design
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../design/processor.html">
     Design of flow.processor
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../reference.html">
   Programming reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../api/index.html">
     API Reference
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../api/flow/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         flow
        </span>
       </code>
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/flow/lang/index.html">
         <code class="xref py py-mod docutils literal notranslate">
          <span class="pre">
           flow.lang
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/flow/model/index.html">
         <code class="xref py py-mod docutils literal notranslate">
          <span class="pre">
           flow.model
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/flow/processor/index.html">
         <code class="xref py py-mod docutils literal notranslate">
          <span class="pre">
           flow.processor
          </span>
         </code>
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../api/flow/cli/index.html">
         <code class="xref py py-mod docutils literal notranslate">
          <span class="pre">
           flow.cli
          </span>
         </code>
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../flow-parse-namespace.html">
     Flow parse namespace
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/parse/dataclass/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         parse.dataclass
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/parse/function/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         parse.function
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/parse/generator/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         parse.generator
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/parse/subclass/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         parse.subclass
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../flow-lib-namespace.html">
     Flow lib namespace
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/lib/arith/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         lib.arith
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/lib/audio/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         lib.audio
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/lib/gen/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         lib.gen
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/lib/out/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         lib.out
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../api/lib/plot/index.html">
       <code class="xref py py-mod docutils literal notranslate">
        <span class="pre">
         lib.plot
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../contributing.html">
   Contributing
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/enodis/python-flow/master?urlpath=tree/doc/guides/writing-nodes.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/enodis/python-flow"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/enodis/python-flow/issues/new?title=Issue%20on%20page%20%2Fguides/writing-nodes.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/guides/writing-nodes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="../_sources/guides/writing-nodes.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generators">
   Generators
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-classes">
   Data classes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stateful-nodes">
   Stateful nodes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-nodes-in-action">
   The nodes in action
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Writing Flow Nodes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generators">
   Generators
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-classes">
   Data classes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stateful-nodes">
   Stateful nodes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-nodes-in-action">
   The nodes in action
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="writing-flow-nodes">
<h1>Writing Flow Nodes<a class="headerlink" href="#writing-flow-nodes" title="Permalink to this headline">#</a></h1>
<div class="admonition-prerequisites admonition">
<p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p><a class="reference internal" href="installing.html"><span class="doc std std-doc">You have installed Flow</span></a></p></li>
</ul>
</div>
<p>In this guide you will learn how to define and use your own flow nodes. We will
touch on constructing a flow graph, for the simple reason that you need to know
how to apply the nodes you define yourself, but otherwise leave the topic of
constructing flow graphs to the guide <a class="reference internal" href="specifying-graphs.html"><span class="doc std std-doc">“specifying graphs”</span></a>.</p>
<p>Defining nodes is done with the <code class="docutils literal notranslate"><span class="pre">lang</span></code> module. The module responsible for the
language that describes flow nodes and flow graphs. We need two components from
this module:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/flow/lang/definition/index.html#flow.lang.definition.node" title="flow.lang.definition.node"><code class="xref py py-func docutils literal notranslate"><span class="pre">node</span></code></a>: a decorator that creates flow
nodes for Python objects.</p></li>
<li><p><code class="xref py py-func docutils literal notranslate"><span class="pre">Namespace</span></code>: the class where, by
default, all flow nodes will be defined. Don’t worry, this will become clear
below.</p></li>
</ul>
<p>We import these component as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flow.lang</span> <span class="kn">import</span> <span class="n">node</span><span class="p">,</span> <span class="n">Namespace</span>
</pre></div>
</div>
</div>
</div>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">#</a></h2>
<p>One of the simplest ways to define a Flow node is with a function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@node</span>
<span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">+</span><span class="n">delta</span>
</pre></div>
</div>
</div>
</div>
<p>This will add a function <code class="docutils literal notranslate"><span class="pre">offset</span></code> to the class <code class="docutils literal notranslate"><span class="pre">Namespace</span></code>, but otherwise leave
the decorated function intact. You can still call it as you normally would:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">offset</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>42
</pre></div>
</div>
</div>
</div>
<p>There now is a method <code class="docutils literal notranslate"><span class="pre">Namespace.offset</span></code> which is a <em>node constructor</em>. Calling
this method, in the appropriate context, will create a node to which values can
be streamed, and which will output those values with an offset.</p>
</section>
<section id="generators">
<h2>Generators<a class="headerlink" href="#generators" title="Permalink to this headline">#</a></h2>
<p>Generators can also be turned into Flow nodes, and are particularly well suited a <em>source</em> nodes. These are nodes that only have ouputs, where they generate data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@node</span>
<span class="k">def</span> <span class="nf">source</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">i</span>
</pre></div>
</div>
</div>
</div>
<p>The node created from this generator is self-activated, it will output a stream of
10 values and stop.</p>
</section>
<section id="data-classes">
<h2>Data classes<a class="headerlink" href="#data-classes" title="Permalink to this headline">#</a></h2>
<p>So far nodes have had single outputs. Even if a function would return a tuple,
it would be considered a single output. What if we want to create a node that
has multiple outputs?</p>
<p>For this we can use a <code class="docutils literal notranslate"><span class="pre">dataclass</span></code> which we must import from
<a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</pre></div>
</div>
</div>
</div>
<p>A dataclass is a convient construct created in Python 3 for the construction of
classes that, mostly, just contain data fields. When we turn it into a node, by
add the <code class="docutils literal notranslate"><span class="pre">&#64;node</span></code> decorator like we did in the previous section, we create a node
with one output for each field in the dataclass.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@node</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DivMod</span><span class="p">:</span>
    <span class="n">quotient</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">remainder</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quotient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This will add <code class="docutils literal notranslate"><span class="pre">DivMod</span></code> as a node constructor to the <code class="docutils literal notranslate"><span class="pre">Namespace</span></code> class. It will
need two inputs, and it will, simultaneously, produce two outputs.</p>
</section>
<section id="stateful-nodes">
<h2>Stateful nodes<a class="headerlink" href="#stateful-nodes" title="Permalink to this headline">#</a></h2>
<p>It is also possible to create nodes with <em>state</em>. The output of such nodes does
not solely depend on the inputs, but also on the internal state. Nodes like this
can be defined using a class that is derived from <a class="reference internal" href="../api/flow/lang/helpers/index.html#flow.lang.helpers.Firable" title="flow.lang.helpers.Firable"><code class="xref py py-func docutils literal notranslate"><span class="pre">Firable</span></code></a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flow.lang</span> <span class="kn">import</span> <span class="n">Firable</span>

<span class="nd">@node</span>
<span class="k">class</span> <span class="nc">accumulate</span><span class="p">(</span><span class="n">Firable</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>

    <span class="k">def</span> <span class="nf">fire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+=</span> <span class="n">a</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
</pre></div>
</div>
</div>
</div>
<p>Firable nodes must have a method called <code class="docutils literal notranslate"><span class="pre">fire</span></code>. This method is responsible for
computing new output values given the latest input values and state, and for
updating the state.</p>
</section>
<section id="the-nodes-in-action">
<h2>The nodes in action<a class="headerlink" href="#the-nodes-in-action" title="Permalink to this headline">#</a></h2>
<p>We can execute the nodes we have just created by constructing a <em>flow graph</em> and
giving that to a <em>processor</em>. But before we do this, we need to create one more
node. We need the data to go somewhere. It needs to have an endpoint. We need to
define a <em>sink</em>, a node with only inputs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@node</span>
<span class="k">def</span> <span class="nf">sink</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sink</span></code> definition should be familiar. The only difference with <code class="docutils literal notranslate"><span class="pre">offset</span></code> is
that it does not return a value, and hence will not create a node that has an
output.</p>
<p>With that done, we can construct if we import one more component from the <code class="docutils literal notranslate"><span class="pre">lang</span></code>
module:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/flow/lang/composition/index.html#flow.lang.composition.graph" title="flow.lang.composition.graph"><code class="xref py py-func docutils literal notranslate"><span class="pre">graph</span></code></a>: a context manager that should be used when creating flow graphs.</p></li>
</ul>
<p>Giving us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flow.lang</span> <span class="kn">import</span> <span class="n">graph</span>

<span class="k">with</span> <span class="n">graph</span><span class="p">()</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">Namespace</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> 
    <span class="n">dm</span> <span class="o">=</span> <span class="n">Namespace</span><span class="o">.</span><span class="n">DivMod</span><span class="p">(</span><span class="n">Namespace</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">s1</span><span class="p">),</span> <span class="n">Namespace</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">dm</span> <span class="o">&gt;&gt;</span> <span class="n">Namespace</span><span class="o">.</span><span class="n">sink</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="s2">&quot;quotient&quot;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="s2">&quot;remainder&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> notation is another part of the flow language, and is described in more
detail in <a class="reference internal" href="specifying-graphs.html"><span class="doc std std-doc">this guide</span></a>. For this guide you should understand
that it specifies streaming from left to right. In this case <em>source</em> has a
single output which will stream to the single input of <em>accumulate</em> and
<em>offset</em>. <em>accumulate</em> has a single output which will stream to the first input
of <em>DivMod</em>, and <em>offset</em> has a single output which will stream to the second
input of <em>DivMod</em>. <em>DivMod</em> has two outputs which will both be streamed to
<em>sink</em>.</p>
<p>Drawing the graph in a notebook is as simple as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/writing-nodes_19_0.svg" src="../_images/writing-nodes_19_0.svg" /></div>
</div>
<p>We can create an example trace of the execution in a sequence diagram (in this
case for a range of 3 integers):</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>source</p></th>
<th class="text-align:center head"><p>c1</p></th>
<th class="text-align:center head"><p>offset</p></th>
<th class="text-align:center head"><p>c2</p></th>
<th class="text-align:center head"><p>accumulate</p></th>
<th class="text-align:center head"><p>c3</p></th>
<th class="text-align:center head"><p>c4</p></th>
<th class="text-align:center head"><p>divmod</p></th>
<th class="text-align:center head"><p>c5</p></th>
<th class="text-align:center head"><p>c6</p></th>
<th class="text-align:center head"><p>sink</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p><strong>0</strong></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>0</strong></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p><strong>1</strong>,0</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>1</strong>,0</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p><strong>2</strong>,1</p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p><strong>2</strong>,1,0</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>4</strong></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>2,1</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>2,1</p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p><strong>1</strong></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>2,1</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>2,1</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p><strong>0</strong></p></td>
<td class="text-align:center"><p><strong>1</strong></p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p>2,1</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>5</strong></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>0</p></td>
<td class="text-align:center"><p>1</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p>5</p></td>
<td class="text-align:center"><p><strong>2</strong></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>0</p></td>
<td class="text-align:center"><p>1</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>6</strong>,5</p></td>
<td class="text-align:center"><p>2</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>0</p></td>
<td class="text-align:center"><p>1</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p>6,5</p></td>
<td class="text-align:center"><p><strong>4</strong>,2</p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>0</p></td>
<td class="text-align:center"><p>1</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>6</p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p><strong>0</strong></p></td>
<td class="text-align:center"><p><strong>2</strong></p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
<td class="text-align:center"><p><strong>0</strong>,0</p></td>
<td class="text-align:center"><p><strong>4</strong>,2</p></td>
<td class="text-align:center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p>0</p></td>
<td class="text-align:center"><p>4</p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p></p></td>
<td class="text-align:center"><p><strong>fire</strong></p></td>
</tr>
</tbody>
</table>
<p>This table shows the behavior of the nodes and channels during execution. The
nodes consume input values from channels and produce output values to channels.
The channels are FIFO’s, meaning the order in which values are put into it by
the producer is the same as the order in which the consumer will take them out
again.</p>
<p>To execute this flow graph we need a processor. The simplest processor is the
<em>offline</em> processor, which can be used as follows:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flow.processor.offline</span> <span class="kn">import</span> <span class="n">OfflineProcessor</span>

<span class="n">OfflineProcessor</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 1
0 2
0 4
1 0
1 3
1 7
2 2
2 7
3 1
3 7
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./guides"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="installing.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Installing flow</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="specifying-graphs.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Specifying graphs</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Wim Yedema<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>